<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>People</title>
</head>
<body>
<script>
    let cityComfort = 0.7;
    let cityDiscomfort = 1 - cityComfort;

    let numberPeople = 2200;
    let money = 1000 * numberPeople;


    class StartSimulation {
        city = new City();
        people = new People();
        iteration = 1;

        startSimulation() {
            this.people.Born();
            this.people.Death();
            this.people.Migration();
            this.people.Emigration();
            this.people.GiveTax();
            this.city.createHouse();
            this.city.buildSupermarket();
            this.GetInfo();
            // this.city.createMainBuild();
            this.iteration++;

            if (this.people.numberWomen === 0 && this.people.numberMen === 0) {
                console.log("Все жители умерли");
                clearTimeout(years);
            }
            let years = setTimeout(() => {
                this.startSimulation();
            }, 1000);
        }

        GetInfo() {
            console.log("\niteration: " + this.iteration);
            console.log("Бюджет города: " + money);
            console.log("Рожденные за год " + this.people.bornPeople);
            console.log("Умершие за год " + this.people.deathPeople);
            console.log("Приехало в город за год: " + this.people.migrationPeople);
            console.log("Уехало с города за год: " + this.people.EMigrationPeople);
            console.log("people " + numberPeople);
            console.log("women: " + this.people.numberWomen + " men: " + this.people.numberMen);
            console.log("Количество жилых домов: " + this.city.houseNumber.length);
            console.log("Количество супермаркетов: " + this.city.supermarketNumber.length);
            // console.log("Порядочность мэра: " + this.city.mainbuild.percentGoodMayor);
        }


    }

    class City {
        buildSupermarketChance = 1;
        houseNumber = [];
        supermarketNumber = [];

        // createMainBuild() {
        //     let percentGoodMayor = Math.floor(Math.random() * 101);
        //     let mainbuild = new MainBuild(percentGoodMayor);
        // }

        createHouse() {
            while (numberPeople / 50 > this.houseNumber.length) {
                money -= 25000;
                let house = new House(this.houseNumber.length);
                this.houseNumber.push(house);
            }
        }

        //Довести до путя шанси постройки супермаркета в залежності від кількості людей
        buildSupermarket() {
            if (this.supermarketNumber.length === 0) {
                console.log("\n Построен новый супермаркет\n");
                let supermarket = new SuperMarket(1);
                money -= 50000;
                this.supermarketNumber.push(supermarket);
            } else if (this.supermarketNumber.length < numberPeople / 2500 + 1) {
                this.buildSupermarketChance = numberPeople / 25;
                let chanceBuild = this.randomInteger(1, 100);
                if (this.buildSupermarketChance >= chanceBuild) {
                    let supermarket = new SuperMarket(1);
                    this.supermarketNumber.push(supermarket);
                    console.log("\n Построен новый супермаркет\n");
                }
            } else {
                this.buildSupermarketChance = 0;
            }
            console.log("\nШанс на построение супермаркета:" + this.buildSupermarketChance + "\n")
        }

        //Довести до путя шанси постройки супермаркета в залежності від кількості людей
        
        randomInteger(min, max) {
            let rand = min - 0.5 + Math.random() * (max - min + 1);
            return Math.round(rand);
        }
    }

    //  class MainBuild {
    //     constructor(percentGoodMayor) {
    //         this.percentGoodMayor = percentGoodMayor;
    //     }
    // }

    class SuperMarket {
        constructor(indexSupermarket) {
            this.indexSupermarket = indexSupermarket;
        }
    }

    class House {
        constructor(indexHouse) {
            this.indexHouse = indexHouse;
        }
    }


    class People {

        // numberMen = Math.floor(Math.random() * this.numberPeople)
        numberMen = numberPeople / 2;
        numberWomen = numberPeople - this.numberMen;
        percentBorn = 2.3;
        percentDeath = 1.15;

        i = 0;
        bornPeople = 0;
        deathPeople = 0;
        migrationPeople = 0;
        EMigrationPeople = 0;
        city = new City();

        rand(number) {
            return (Math.random() * number);
        }

        Born() {
            this.i = 0;
            this.bornPeople = 0;
            if (this.numberWomen > 0 && this.numberMen > 0) {
                while (this.i < this.numberWomen) {
                    let chanceBorn = this.rand(100);
                    if (this.percentBorn >= chanceBorn) {
                        numberPeople++;
                        this.bornPeople++;
                        this.getGenderInp()
                    }
                    this.i++;
                }
            }


        }

        Death() {
            this.i = 0;
            this.deathPeople = 0;
            while (this.i < numberPeople) {
                let chanceDeath = this.rand(100);
                if (this.percentDeath >= chanceDeath) {
                    numberPeople--;
                    this.deathPeople++;
                    this.getGenderOut()
                }
                this.i++;
            }

        }

        Migration() {
            this.i = 0;
            this.migrationPeople = Math.floor(this.rand(numberPeople * (0.005 + cityComfort / 10)));
            numberPeople += this.migrationPeople;
            while (this.i < this.migrationPeople) {
                this.getGenderInp()
                this.i++;
            }
        }

        Emigration() {
            this.i = 0;
            this.EMigrationPeople = Math.floor(this.rand(numberPeople * (0.005 + cityDiscomfort / 10)));
            numberPeople -= this.EMigrationPeople;
            while (this.i < this.EMigrationPeople) {
                this.getGenderOut()
                this.i++;
            }
        }

        getGenderInp() {
            let gender = Math.floor(this.rand(2));
            if (gender === 1) {
                this.numberMen++;
            } else if (gender === 0) this.numberWomen++;
        }

        getGenderOut() {
            let gender = Math.floor(this.rand(2));
            if (gender === 1 && this.numberMen > 0) this.numberMen--;
            else if (gender === 1 && this.numberMen === 0) this.numberWomen--;
            else if (gender === 0 && this.numberWomen > 0) this.numberWomen--;
            else if (gender === 0 && this.numberMen === 0) this.numberMen--;
        }


        GiveTax() {
            money += numberPeople * 25;
        }


    }

    let start = new StartSimulation();
    start.startSimulation();

</script>
</body>
</html>